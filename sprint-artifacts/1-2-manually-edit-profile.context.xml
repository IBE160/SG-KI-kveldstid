<?xml version="1.0" encoding="UTF-8"?>
<StoryContext>
    <Story id="1.2" name="Manually Edit Profile" epic="Epic 1: Core Profile Management">
        <Description>
            As a job seeker,
            I want to manually edit my parsed CV information,
            So that I can correct any parsing errors or add missing details.
        </Description>
        <AcceptanceCriteria>
            <Criterion id="1">
                <Given>My CV has been parsed</Given>
            </Criterion>
            <Criterion id="2">
                <When>I navigate to the profile editing interface</When>
            </Criterion>
            <Criterion id="3">
                <Then>I can see and modify extracted fields (e.g., job titles, dates, descriptions, skills).</Then>
            </Criterion>
            <Criterion id="4">
                <And>The changes are saved to my profile.</And>
            </Criterion>
        </AcceptanceCriteria>
    </Story>

    <TechnicalDetails>
        <Frontend>
            <Component>ProfileEditPage.jsx (New Page/Component)</Component>
            <Description>Develop a React UI for the profile editing interface to display and allow modification of extracted CV fields. Implement functionality to send updated data to the backend.</Description>
            <FilesToTouch>
                <File>frontend/src/pages/ProfileEditPage.jsx</File>
                <File>frontend/src/api/cv.js (for update service)</File>
            </FilesToTouch>
            <Considerations>
                <Consideration>WCAG 2.1 Level AA Accessibility: Ensure all new components are designed with accessibility in mind (labels, ARIA, keyboard navigation).</Consideration>
            </Considerations>
        </Frontend>
        <Backend>
            <Endpoint>GET /cv_documents/{cv_id}</Endpoint>
            <Endpoint>PUT /cv_documents/{cv_id}</Endpoint>
            <Description>Implement API endpoints to retrieve and update specific CV data. Implement CRUD operations for updating CvDocument, and update schemas for API requests/responses.</Description>
            <FilesToTouch>
                <File>backend/app/api/endpoints/documents.py</File>
                <File>backend/app/crud/crud_cv_document.py</File>
                <File>backend/app/schemas/cv_document.py</File>
            </FilesToTouch>
            <Considerations>
                <Consideration>Data Synchronization: Design API contract for efficient fetching and updating of nested CV fields.</Consideration>
                <Consideration>Validation Logic: Implement robust validation for updated fields.</Consideration>
                <Consideration>Error Handling & Logging: Adhere to standardized strategies as per architecture.md.</Consideration>
            </Considerations>
        </Backend>
        <Database>
            <Entity>CV Document</Entity>
            <Description>Utilize `CV Document` entity in PostgreSQL. Structured `parsed_sections_json` field is key for this story. Needs to support efficient retrieval and updates of potentially complex CV data structures.</Description>
        </Database>
    </TechnicalDetails>

    <Dependencies>
        <Dependency>Story 1.1: Upload CV (Text-only) completed with structured data extraction implemented.</Dependency>
    </Dependencies>

    <TestingStrategy>
        <Backend>
            <TestType>Unit Tests</TestType>
            <Description>For CRUD update operations.</Description>
            <TestType>Integration Tests</TestType>
            <Description>For `GET /cv_documents/{cv_id}` and `PUT /cv_documents/{cv_id}` API endpoints.</Description>
        </Backend>
        <Frontend>
            <TestType>Component Tests</TestType>
            <Description>For the profile editing UI.</Description>
        </Frontend>
    </TestingStrategy>

    <Risks>
        <Risk>User Experience for Editing: Designing an intuitive and efficient manual editing interface for complex, potentially nested, CV data can be challenging.</Risk>
        <Risk>Data Migration: If the `cv_document` database schema is significantly altered to support structured data, a migration strategy for any existing `raw_text_content` will be required.</Risk>
        <Risk>Performance Optimization (Ongoing): Structured parsing, especially with external LLM calls, has performance implications. Optimization and monitoring will be an ongoing task.</Risk>
    </Risks>
</StoryContext>
