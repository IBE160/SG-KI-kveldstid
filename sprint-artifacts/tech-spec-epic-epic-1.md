# Technical Context for Epic 1: Core Profile Management

## Goal

Enable users to input and manage their CV data for job application purposes.

## Stories within Epic 1

*   **Story 1.1: Upload CV (Text-only)**
    *   *Description:* As a job seeker, I want to upload my CV as a text-only document, so that the system can parse my skills and experience for job matching.
    *   *Current Status:* Completed. Structured data extraction using OpenAI's GPT-4-turbo model has been implemented.
*   **Story 1.2: Manually Edit Profile**
    *   *Description:* As a job seeker, I want to manually edit my parsed CV information, so that I can correct any parsing errors or add missing details.

## Architectural Components Involved

### Frontend (`frontend/src/` components)

*   **`ProfileCreationPage.jsx`**: Already exists for Story 1.1, and has been updated for WCAG 2.1 Level AA compliance. Will need integration points for navigation to editing features.
*   **New Components**: Required for displaying and editing various CV fields (e.g., work experience, education, skills, contact information) for Story 1.2.
*   **API Interaction**: Communication with the backend will be handled via `frontend/src/api/` (e.g., `cv.js`, potentially new files for profile management). Frontend API URL needs to be configurable via environment variables.

### Backend (FastAPI - `backend/app/`)

*   **API Endpoints (`backend/app/api/endpoints/`):**
    *   `POST /cv_documents`: Existing endpoint for CV upload (Story 1.1).
    *   `GET /cv_documents/{cv_id}`: New endpoint to retrieve specific CV data for editing (needed for Story 1.2).
    *   `PUT /cv_documents/{cv_id}`: New endpoint to update CV data (needed for Story 1.2).
    *   `DELETE /cv_documents/{cv_id}`: (Consider for full CRUD, though not explicitly in Story 1.2 AC, might be implied by "manage").
*   **Core Services (`backend/app/core/`):**
    *   `parsing.py`: Existing text extraction from CVs. **Enhanced for structured data extraction** using OpenAI's GPT-4-turbo model.
    *   `s3.py`: Existing for storing raw CV files. **Security hardening implemented** for filename handling (using UUIDs for object names).
*   **CRUD Operations (`backend/app/crud/`):**
    *   `crud_cv_document.py`: Existing for database interactions. Needs new functions for retrieving and updating CV data by ID (for Story 1.2).
*   **Models (`backend/app/models/`):**
    *   `cv_document.py`: Database model for CV data. May need significant adjustments to accommodate structured data (e.g., new fields or a JSONB column for `parsed_sections_json` as mentioned in `architecture.md`).
*   **Schemas (`backend/app/schemas/`):**
    *   `cv_document.py`: Pydantic schemas for request/response. Needs updates to support structured data in both input for updates and output for display/editing.

### Database (PostgreSQL with `pgvector`)

*   **`CV Document` Entity**: Will store `raw_text_content` and, once implemented, `parsed_sections_json` (structured data). The `embedding` column will be utilized later for semantic matching in Epic 2.
*   Needs to support efficient retrieval and updates of potentially complex CV data structures.

## Key Technical Considerations & Dependencies

1.  **Frontend/Backend Data Synchronization (Story 1.2):** Design the API contract for `GET/PUT /cv_documents/{cv_id}` to allow efficient fetching and updating of specific, potentially nested, CV fields without re-uploading the entire document.
2.  **Error Handling & Logging:** Ensure new API endpoints and modified services (`parsing.py`, `s3.py`, `crud_cv_document.py`) adhere to the standardized error handling and structured logging strategies defined in `architecture.md`.
3.  **Testing Strategy:** Implement comprehensive unit tests for `parsing.py` enhancements and new CRUD functions. Create integration tests for `GET/PUT /cv_documents/{cv_id}` endpoints. Develop component tests for the new frontend editing UI, ensuring proper data flow and user interaction.
4.  **Configuration Management:** The hardcoded `API_URL` in `frontend/src/api/cv.js` must be replaced with an environment variable for deployment flexibility. (This is the only remaining technical consideration from this list.)

## Open Questions/Risks


*   **User Experience for Editing:** Designing an intuitive and efficient manual editing interface for complex, potentially nested, CV data (e.g., multiple work experiences with sub-fields) can be challenging.
*   **Data Migration:** If the `cv_document` database schema is significantly altered to support structured data, a migration strategy for any existing `raw_text_content` (from Story 1.1) will be required.
*   **Performance Optimization (Ongoing):** Structured parsing, especially with external LLM calls, has performance implications. Optimization and monitoring will be an ongoing task.

---
_Generated by SM Agent - create-epic-tech-context workflow_
_Date: 2025-12-08_